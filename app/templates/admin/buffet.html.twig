{% extends '@EasyAdmin/page/content.html.twig' %}

{% block content_title %}Buffet{% endblock %}

{% block head_stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/buffet.css') }}">
    <style>
        {% for shelf in shelves %}
        .shelf[data-shelf-id="{{ shelf.id }}"] {
            top: {{ shelf.y }}px;
            left: {{ shelf.x }}px;
            width: {{ shelf.width }}px;
            height: {{ shelf.height }}px;
        }
        {% endfor %}
    </style>
{% endblock %}

{% block body_javascript %}
    {{ parent() }}
    <script src="{{ asset('buffet.js') }}"></script>
{% endblock %}

{% block main %}
    <div class="content-panel">
        <div class="mb-2">
            <a href="/buffet">Public view</a>
        </div>
        <h2 class="h4 mb-3">Overview</h2>
        <p>Welcome to the Buffet admin. Use the menu to manage dishes and review updates.</p>
        <div class="buffet-message" aria-live="polite"></div>
        <div class="buffet-layout mt-3">
            <div class="buffet-cupboard">
                {% for shelf in shelves %}
                    <div class="shelf" data-shelf-id="{{ shelf.id }}">
                        {% for group in stackGroupsByShelf[shelf.id]|default([]) %}
                            {% set placement = group.placement %}
                            <div
                                class="stack-item"
                                draggable="true"
                                id="stack-item-stack-{{ placement.id }}"
                                data-dish-id="{{ placement.dish.id }}"
                                data-dish-type="{{ placement.dish.type }}"
                                data-stack-limit="{{ placement.dish.stackLimit }}"
                                data-stack-id="{{ placement.id }}"
                                data-stack-count="{{ group.count }}"
                                data-image="{{ asset(placement.dish.image) }}"
                                data-width="{{ placement.width }}"
                                data-height="{{ placement.height }}"
                                style="left: {{ placement.x }}px; bottom: {{ placement.y }}px; width: {{ placement.width }}px; height: {{ placement.height }}px;"
                            >
                                <div class="placed-dish">
                                    <img src="{{ asset(placement.dish.image) }}" alt="{{ placement.dish.name }}">
                                </div>
                                <div
                                    class="stack-badge"
                                    data-stack-badge
                                    style="{% if (group.count ?? 0) < 2 %}display:none;{% endif %}"
                                >{{ group.count }}</div>
                                <div
                                    class="stack-controls"
                                    data-stack-controls
                                    style="{% if (group.count ?? 0) < 2 %}display:none;{% endif %}"
                                >
                                    <button type="button" class="stack-add" aria-label="Add to stack" draggable="false">+</button>
                                    <button type="button" class="stack-remove" aria-label="Remove from stack" draggable="false">-</button>
                                </div>
                                <button type="button" class="placed-delete" aria-label="Delete dish" draggable="false">Ã—</button>
                            </div>
                        {% endfor %}
                    </div>
                {% endfor %}
            </div>
            <div class="buffet-items">
                {% for dish in dishes %}
                    <img
                        src="{{ asset(dish.image) }}"
                        alt="{{ dish.name }}"
                        draggable="true"
                        data-dish-id="{{ dish.id }}"
                        data-dish-type="{{ dish.type }}"
                        data-stack-limit="{{ dish.stackLimit }}"
                        data-image="{{ asset(dish.image) }}"
                        data-width="{{ dish.width }}"
                        data-height="{{ dish.height }}"
                    >
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}
